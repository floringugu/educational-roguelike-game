<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educational Roguelike - {{ deck.deck_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pixel-style.css') }}">
</head>
<body>
    <div class="container" id="game-container" data-deck-id="{{ deck.id }}">
        <!-- Header -->
        <div class="page-header">
            <h1 class="page-title">‚öîÔ∏è {{ deck.deck_name }}</h1>
            <div class="btn-group">
                <a href="/" class="btn">üè† Home</a>
                <a href="/stats/{{ deck.id }}" class="btn btn-secondary">üìä Stats</a>
            </div>
        </div>

        <!-- Welcome Screen -->
        <div id="welcome-screen" class="{% if ready %}{% else %}visible{% endif %}">
            {% if not ready %}
            <div class="card text-center">
                <div class="card-title text-warning">‚ö†Ô∏è Not Ready</div>
                <div class="card-content">
                    <p>This deck has no cards. Please upload a valid Anki CSV file.</p>
                    <a href="/" class="btn btn-primary mt-lg">‚Üê Back to Home</a>
                </div>
            </div>
            {% else %}
            <div class="card text-center">
                <div class="card-title text-primary">üéÆ Ready to Play!</div>
                <div class="card-content">
                    <p class="mb-lg" style="line-height: 2;">
                        <strong>{{ card_count }}</strong> cards ready<br>
                        Study cards using spaced repetition<br>
                        Rate your recall: Again, Hard, Good, Easy<br>
                        Better recall = More damage!<br>
                        Survive 10 encounters to win!
                    </p>
                    <button id="new-game-btn" class="btn btn-primary">‚öîÔ∏è Start New Game</button>
                    <a href="/saves/{{ deck.id }}" class="btn mt-md">üíæ Load Saved Game</a>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="hidden">
            <!-- Game Board -->
            <div class="game-board">
                <!-- Left Column: Player & Enemy -->
                <div>
                    <!-- Player Panel -->
                    <div class="character-panel mb-lg">
                        <div class="character-sprite player-sprite" id="player-sprite">üßô</div>
                        <div class="character-info">
                            <div class="character-name">You</div>

                            <div class="health-bar-container">
                                <div class="health-bar">
                                    <div class="health-bar-fill" id="player-hp-fill" style="width: 100%"></div>
                                    <div class="health-text" id="player-hp-text">100/100</div>
                                </div>
                            </div>

                            <div class="character-stat">
                                <span>üí∞ Score:</span>
                                <span class="text-primary" id="player-score">0</span>
                            </div>

                            <div id="player-shield" class="shield-indicator hidden">
                                üõ°Ô∏è Shield: 0
                            </div>
                        </div>
                    </div>

                    <!-- Enemy Panel -->
                    <div class="character-panel">
                        <div class="character-sprite enemy-sprite" id="enemy-sprite">üêâ</div>
                        <div class="character-info">
                            <div class="character-name" id="enemy-name">Dragon</div>
                            <div id="boss-indicator" class="boss-indicator hidden">‚ö†Ô∏è BOSS ‚ö†Ô∏è</div>

                            <div class="health-bar-container">
                                <div class="health-bar">
                                    <div class="health-bar-fill" id="enemy-hp-fill" style="width: 100%"></div>
                                    <div class="health-text" id="enemy-hp-text">100/100</div>
                                </div>
                            </div>

                            <div class="character-stat">
                                <span>üí• Damage:</span>
                                <span class="text-danger" id="enemy-damage">25</span>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="progress-bar-container mt-lg">
                        <div class="progress-label" id="progress-text">Encounter 1/10</div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill" id="progress-fill" style="width: 10%"></div>
                        </div>
                    </div>

                    <!-- Session Stats -->
                    <div class="card mt-lg">
                        <div class="card-title">üìà Session Stats</div>
                        <div class="card-content">
                            <div class="character-stat">
                                <span>Cards Reviewed:</span>
                                <span id="cards-reviewed">0</span>
                            </div>
                            <div class="character-stat">
                                <span>Accuracy:</span>
                                <span class="text-primary" id="session-accuracy">0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Inventory Panel -->
                    <div class="card mt-lg">
                        <div class="card-title">üéí Inventory</div>
                        <div class="card-content" id="inventory-container">
                            <div class="text-muted" id="inventory-empty">No items yet</div>
                            <div id="inventory-items" style="display: flex; flex-direction: column; gap: 8px;"></div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <button id="save-game-btn" class="btn btn-secondary mt-md" style="width: 100%;">
                        üíæ Save Game
                    </button>
                </div>

                <!-- Right Column: Flashcard -->
                <div>
                    <!-- Flashcard Panel -->
                    <div id="card-panel" class="question-panel hidden">
                        <div class="question-header">
                            <div class="question-topic" id="card-tags">üè∑Ô∏è Tags</div>
                            <div class="question-difficulty" id="card-status" style="font-size: 9px;">New Card</div>
                        </div>

                        <!-- Card Front (Question) -->
                        <div id="card-front-container">
                            <div class="question-text" id="card-front">
                                Card front will appear here...
                            </div>
                            <div class="btn-group mt-lg">
                                <button id="reveal-btn" class="btn btn-primary">
                                    üëÅÔ∏è Reveal Answer
                                </button>
                            </div>
                        </div>

                        <!-- Card Back (Answer) - Hidden until revealed -->
                        <div id="card-back-container" class="hidden">
                            <div class="feedback-panel">
                                <div class="feedback-title">üìù Answer</div>
                                <div class="feedback-text" id="card-back">
                                    Card back will appear here...
                                </div>
                            </div>

                            <!-- Anki-style Response Buttons -->
                            <div class="mt-lg">
                                <p style="font-size: 10px; text-align: center; margin-bottom: 12px; color: var(--color-text-muted);">
                                    How well did you remember this card?
                                </p>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                    <button id="response-again" class="btn" style="background: var(--color-danger); border-color: var(--color-danger);">
                                        üî¥ AGAIN<br>
                                        <span style="font-size: 8px;">0 damage</span>
                                    </button>
                                    <button id="response-hard" class="btn" style="background: #ff8800; border-color: #ff8800;">
                                        üü° HARD<br>
                                        <span style="font-size: 8px;">~6-10 damage</span>
                                    </button>
                                    <button id="response-good" class="btn" style="background: var(--color-hp-high); border-color: var(--color-hp-high);">
                                        üü¢ GOOD<br>
                                        <span style="font-size: 8px;">~16-24 damage</span>
                                    </button>
                                    <button id="response-easy" class="btn" style="background: var(--color-primary); border-color: var(--color-primary);">
                                        üîµ EASY<br>
                                        <span style="font-size: 8px;">~32-48 damage!</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Battle Log -->
                    <div class="battle-log mt-lg" id="battle-log">
                        <div class="log-entry log-info">> Welcome to the dungeon!</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="loading-indicator" class="hidden notification info">Loading...</div>

    <script src="{{ url_for('static', filename='js/animations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
</body>
</html>
